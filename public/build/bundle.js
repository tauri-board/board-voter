var app=function(){"use strict";function t(){}function n(t){return t()}function e(){return Object.create(null)}function o(t){t.forEach(n)}function r(t){return"function"==typeof t}function u(t,n){return t!=t?n==n:t!==n||t&&"object"==typeof t||"function"==typeof t}function a(t,n){t.appendChild(n)}function i(t,n,e){t.insertBefore(n,e||null)}function l(t){t.parentNode.removeChild(t)}function c(t,n){for(let e=0;e<t.length;e+=1)t[e]&&t[e].d(n)}function s(t){return document.createElement(t)}function d(t){return document.createTextNode(t)}function f(){return d(" ")}function g(t,n,e,o){return t.addEventListener(n,e,o),()=>t.removeEventListener(n,e,o)}function m(t,n,e){null==e?t.removeAttribute(n):t.getAttribute(n)!==e&&t.setAttribute(n,e)}function h(t,n){n=""+n,t.wholeText!==n&&(t.data=n)}let p;function v(t){p=t}const _=[],$=[],b=[],y=[],x=Promise.resolve();let w=!1;function S(t){b.push(t)}const j=new Set;let N=0;function E(){const t=p;do{for(;N<_.length;){const t=_[N];N++,v(t),O(t.$$)}for(v(null),_.length=0,N=0;$.length;)$.pop()();for(let t=0;t<b.length;t+=1){const n=b[t];j.has(n)||(j.add(n),n())}b.length=0}while(_.length);for(;y.length;)y.pop()();w=!1,j.clear(),v(t)}function O(t){if(null!==t.fragment){t.update(),o(t.before_update);const n=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,n),t.after_update.forEach(S)}}const k=new Set;function C(t,n){-1===t.$$.dirty[0]&&(_.push(t),w||(w=!0,x.then(E)),t.$$.dirty.fill(0)),t.$$.dirty[n/31|0]|=1<<n%31}function A(u,a,i,c,s,d,f,g=[-1]){const m=p;v(u);const h=u.$$={fragment:null,ctx:null,props:d,update:t,not_equal:s,bound:e(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(a.context||(m?m.$$.context:[])),callbacks:e(),dirty:g,skip_bound:!1,root:a.target||m.$$.root};f&&f(h.root);let _=!1;if(h.ctx=i?i(u,a.props||{},((t,n,...e)=>{const o=e.length?e[0]:n;return h.ctx&&s(h.ctx[t],h.ctx[t]=o)&&(!h.skip_bound&&h.bound[t]&&h.bound[t](o),_&&C(u,t)),n})):[],h.update(),_=!0,o(h.before_update),h.fragment=!!c&&c(h.ctx),a.target){if(a.hydrate){const t=function(t){return Array.from(t.childNodes)}(a.target);h.fragment&&h.fragment.l(t),t.forEach(l)}else h.fragment&&h.fragment.c();a.intro&&(($=u.$$.fragment)&&$.i&&(k.delete($),$.i(b))),function(t,e,u,a){const{fragment:i,on_mount:l,on_destroy:c,after_update:s}=t.$$;i&&i.m(e,u),a||S((()=>{const e=l.map(n).filter(r);c?c.push(...e):o(e),t.$$.on_mount=[]})),s.forEach(S)}(u,a.target,a.anchor,a.customElement),E()}var $,b;v(m)}function M(t,n,e){const o=t.slice();return o[19]=n[e],o[21]=e,o}function J(t,n,e){const o=t.slice();return o[22]=n[e],o[21]=e,o}function P(t,n,e){const o=t.slice();return o[24]=n[e],o[26]=e,o}function T(t){let n,e;return{c(){n=s("div"),e=d(t[1]),m(n,"class","big_bad svelte-4vnj0u")},m(t,o){i(t,n,o),a(n,e)},p(t,n){2&n&&h(e,t[1])},d(t){t&&l(n)}}}function V(t){let n,e,o,r=t[24]==t[21]?"#"+(t[26]+1):"";return{c(){n=s("td"),e=d(r),m(n,"title",o=`Vote cursor: ${t[4].round_selection[t[26]]}\nCounted as: ${t[4].round_count[t[26]].join("|")}`)},m(t,o){i(t,n,o),a(n,e)},p(t,u){16&u&&r!==(r=t[24]==t[21]?"#"+(t[26]+1):"")&&h(e,r),16&u&&o!==(o=`Vote cursor: ${t[4].round_selection[t[26]]}\nCounted as: ${t[4].round_count[t[26]].join("|")}`)&&m(n,"title",o)},d(t){t&&l(n)}}}function L(t){let n,e,o,r,u,g,m,p,v,_,$=t[22]+"",b=t[4].count[t[21]]+"",y=t[4].rate[t[21]]>=I?"✔":"",x=t[4].round_wins,w=[];for(let n=0;n<x.length;n+=1)w[n]=V(P(t,x,n));return{c(){n=s("tr"),e=s("th"),o=d($),r=f(),u=s("td"),g=d(b),m=f(),p=d(y),v=f();for(let t=0;t<w.length;t+=1)w[t].c();_=f()},m(t,l){i(t,n,l),a(n,e),a(e,o),a(n,r),a(n,u),a(u,g),a(u,m),a(u,p),a(n,v);for(let t=0;t<w.length;t+=1)w[t].m(n,null);a(n,_)},p(t,e){if(4&e&&$!==($=t[22]+"")&&h(o,$),16&e&&b!==(b=t[4].count[t[21]]+"")&&h(g,b),16&e&&y!==(y=t[4].rate[t[21]]>=I?"✔":"")&&h(p,y),16&e){let o;for(x=t[4].round_wins,o=0;o<x.length;o+=1){const r=P(t,x,o);w[o]?w[o].p(r,e):(w[o]=V(r),w[o].c(),w[o].m(n,_))}for(;o<w.length;o+=1)w[o].d(1);w.length=x.length}},d(t){t&&l(n),c(w,t)}}}function U(t){let n,e,o;return{c(){n=s("input"),m(n,"type","number"),n.value=-.5,m(n,"step",.5),m(n,"min",-10),m(n,"max",-.5)},m(r,u){i(r,n,u),e||(o=g(n,"change",t[11](t[21])),e=!0)},p(n,e){t=n},d(t){t&&l(n),e=!1,o()}}}function q(t){let n,e,o,r,u,c,p,v,_,$,b,y=t[19]+"",x=t[21]<t[0].num_again&&U(t);return{c(){n=s("p"),e=s("strong"),o=d(y),r=d(":"),u=f(),c=s("input"),v=f(),x&&x.c(),_=f(),m(c,"type","text"),c.value=p=Y(t[0].voted[t[21]])},m(l,s){i(l,n,s),a(n,e),a(e,o),a(e,r),a(n,u),a(n,c),a(n,v),x&&x.m(n,null),a(n,_),$||(b=g(c,"change",t[10](t[21])),$=!0)},p(e,r){t=e,8&r&&y!==(y=t[19]+"")&&h(o,y),1&r&&p!==(p=Y(t[0].voted[t[21]]))&&c.value!==p&&(c.value=p),t[21]<t[0].num_again?x?x.p(t,r):(x=U(t),x.c(),x.m(n,_)):x&&(x.d(1),x=null)},d(t){t&&l(n),x&&x.d(),$=!1,b()}}}function B(n){let e,r,u,h,p,v,_,$,b,y,x,w,S,j,N,E,O,k,C,A,P,V,U,B,I,K,W=n[1]&&T(n),X=n[2],Y=[];for(let t=0;t<X.length;t+=1)Y[t]=L(J(n,X,t));let Z=n[3],tt=[];for(let t=0;t<Z.length;t+=1)tt[t]=q(M(n,Z,t));return{c(){e=s("main"),W&&W.c(),r=f(),u=s("h2"),h=s("input"),v=d("\n    candidates, for\n    "),_=s("input"),b=d("\n    seats"),y=f(),x=s("table");for(let t=0;t<Y.length;t+=1)Y[t].c();w=f(),S=s("div"),j=s("h2"),N=s("input"),O=d("\n      voters, with\n      "),k=s("input"),A=d("\n      running again"),P=f();for(let t=0;t<tt.length;t+=1)tt[t].c();V=f(),U=s("textarea"),m(h,"type","number"),h.value=p=n[0].num_candidates,m(h,"step","1"),m(h,"min",D),m(h,"max",R),m(_,"type","number"),_.value=$=n[0].seats,m(_,"step","1"),m(_,"min",z),m(_,"max",F),m(u,"class","svelte-4vnj0u"),m(N,"type","number"),N.value=E=n[0].num_voters,m(N,"step","1"),m(N,"min",G),m(N,"max",H),m(k,"type","number"),k.value=C=n[0].num_again,m(k,"step","1"),m(k,"min","0"),m(k,"max",H),m(j,"class","svelte-4vnj0u"),m(U,"class","share svelte-4vnj0u"),U.value=B=JSON.stringify(n[0],null,2),m(e,"class","svelte-4vnj0u")},m(t,o){i(t,e,o),W&&W.m(e,null),a(e,r),a(e,u),a(u,h),a(u,v),a(u,_),a(u,b),a(e,y),a(e,x);for(let t=0;t<Y.length;t+=1)Y[t].m(x,null);a(e,w),a(e,S),a(S,j),a(j,N),a(j,O),a(j,k),a(j,A),a(S,P);for(let t=0;t<tt.length;t+=1)tt[t].m(S,null);a(e,V),a(e,U),I||(K=[g(h,"change",n[6]),g(_,"change",n[5]),g(N,"change",n[7]),g(k,"change",n[8]),g(U,"focus",Q),g(U,"change",n[9])],I=!0)},p(t,[n]){if(t[1]?W?W.p(t,n):(W=T(t),W.c(),W.m(e,r)):W&&(W.d(1),W=null),1&n&&p!==(p=t[0].num_candidates)&&h.value!==p&&(h.value=p),1&n&&$!==($=t[0].seats)&&_.value!==$&&(_.value=$),20&n){let e;for(X=t[2],e=0;e<X.length;e+=1){const o=J(t,X,e);Y[e]?Y[e].p(o,n):(Y[e]=L(o),Y[e].c(),Y[e].m(x,null))}for(;e<Y.length;e+=1)Y[e].d(1);Y.length=X.length}if(1&n&&E!==(E=t[0].num_voters)&&N.value!==E&&(N.value=E),1&n&&C!==(C=t[0].num_again)&&k.value!==C&&(k.value=C),3081&n){let e;for(Z=t[3],e=0;e<Z.length;e+=1){const o=M(t,Z,e);tt[e]?tt[e].p(o,n):(tt[e]=q(o),tt[e].c(),tt[e].m(S,null))}for(;e<tt.length;e+=1)tt[e].d(1);tt.length=Z.length}1&n&&B!==(B=JSON.stringify(t[0],null,2))&&(U.value=B)},i:t,o:t,d(t){t&&l(e),W&&W.d(),c(Y,t),c(tt,t),I=!1,o(K)}}}const D=2,R=26,z=1,F=5,G=3,H=7,I=.5;function K(t){let n=0,e=t[0];for(let o=1;o<t.length;o++)t[o]>e&&(n=o,e=t[o]);return n}function Q(t){t.preventDefault(),setTimeout((()=>{t.target.setSelectionRange(0,t.target.value.length)}),1)}function W(t,n,e){return Math.min(Math.max(t,n),e)}function X(t){return String.fromCodePoint(65+t)}function Y(t){return t?t.split("").join(", "):""}function Z(t,n,e){let{setup:o={seats:2,num_candidates:5,num_voters:5,num_again:2,handicap:[],voted:[]}}=n;function r(){window.localStorage.setup=JSON.stringify(o),d()}function u(t){try{e(0,o=Object.assign(Object.assign({},o),JSON.parse(t||window.localStorage.setup))),g(),m(),r()}catch(t){}}u();let{big_bad:a=null}=n,{candidates:i=[]}=n,{voters:l=[]}=n,{out:c={count:[],rate:[],round_selection:[],round_count:[],round_wins:[]}}=n;function s(t,n,e){let r=Array(o.num_candidates).fill(0);n.forEach(((t,n)=>{r[n]=t})),Array(o.num_candidates).fill(0);for(const n of e){let e=t.get(n);if(void 0===e)throw`Vote for unknown candidate '${n}'`;r[e]++}return r}function d(){try{e(1,a=null);let t=new Map,n=Array(o.num_voters).fill(0),r=new Set,u=new Set;function d(){for(let t=0;t<o.num_voters;t++){let e=0;for(;r.has(o.voted[t][e])||u.has(o.voted[t][e]);)e++;n[t]=e}}e(4,c.round_selection=[],c),e(4,c.round_count=[],c),e(4,c.round_wins=[],c),o.voted.forEach(((t,n)=>{let e=t.split(""),r=l[n],u=Array.from(function(t){const n=new Set,e=new Set;return t.forEach((t=>{n.has(t)?e.add(t):n.add(t)})),e}(e));if(u.length>0)throw`Voter ${r} has duplicate votes for ${u}`;if(n<o.num_again&&e[0]!=r)throw`Candidate ${r} is running again, but MUST vote for self first`})),i.forEach(((n,e)=>t.set(n,e))),e(4,c.count=s(t,[],o.voted.join("")),c),e(4,c.rate=c.count.map((t=>t/o.num_voters)),c),c.rate.forEach(((t,n)=>{t<I&&u.add(i[n])}));for(let f=0;f<o.seats;f++){d();let g=n.map(((t,n)=>o.voted[n][t])).join("");if(""==g)throw`No more suitable candidates than ${f}`;let m=s(t,o.handicap,g),h=K(m);r.add(i[h]),c.round_selection.push(g),c.round_count.push(m),c.round_wins.push(h),console.log(f,g,h)}}catch(p){e(1,a=p.toString())}}function f(t){return t<o.num_again?String.fromCodePoint(65+t):String.fromCodePoint(91-o.num_candidates+t)}function g(){e(2,i=[]);for(let t=0;t<o.num_candidates;t++)i.push(f(t))}function m(){e(3,l=[]);for(let t=0;t<o.num_voters;t++)l.push(X(t))}return g(),m(),d(),t.$$set=t=>{"setup"in t&&e(0,o=t.setup),"big_bad"in t&&e(1,a=t.big_bad),"candidates"in t&&e(2,i=t.candidates),"voters"in t&&e(3,l=t.voters),"out"in t&&e(4,c=t.out)},[o,a,i,l,c,function(t){e(0,o.seats=W(z,Number(t.target.value),F),o),t.target.value=o.seats,r()},function(t){e(0,o.num_candidates=W(D,Number(t.target.value),R),o),t.target.value=o.num_candidates,g(),r()},function(t){e(0,o.num_voters=W(G,Number(t.target.value),H),o),t.target.value=o.num_voters,m(),r()},function(t){let n=Math.min(o.num_candidates,o.num_voters);e(0,o.num_again=W(0,Number(t.target.value),n),o),t.target.value=o.num_again,g(),r()},function(t){u(t.target.value),t.target.value=JSON.stringify(o,null,2)},t=>n=>{let u=function(t){return t.toUpperCase().split(/[,; ]*/).join("")}(n.target.value);e(0,o.voted[t]=u,o),n.target.value=Y(u),r()},t=>n=>{e(0,o.handicap[t]=Number(n.target.value),o),r()}]}return new class extends class{$destroy(){!function(t,n){const e=t.$$;null!==e.fragment&&(o(e.on_destroy),e.fragment&&e.fragment.d(n),e.on_destroy=e.fragment=null,e.ctx=[])}(this,1),this.$destroy=t}$on(t,n){const e=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return e.push(n),()=>{const t=e.indexOf(n);-1!==t&&e.splice(t,1)}}$set(t){var n;this.$$set&&(n=t,0!==Object.keys(n).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),A(this,t,Z,B,u,{setup:0,big_bad:1,candidates:2,voters:3,out:4,onseats:5,oncandidates:6,onvoters:7,onagain:8})}get onseats(){return this.$$.ctx[5]}get oncandidates(){return this.$$.ctx[6]}get onvoters(){return this.$$.ctx[7]}get onagain(){return this.$$.ctx[8]}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
